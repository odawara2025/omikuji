<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜ï¼ˆç¸¦ç”»é¢ã‚¹ãƒãƒ›ç‰ˆï¼‰</title>
<style>
body,html{margin:0;padding:0;font-family:"Hiragino Kaku Gothic Pro","Yu Gothic","Noto Sans JP",sans-serif;background:linear-gradient(#0b1220,#101827);color:#fff;display:flex;justify-content:center;}
.wrap{width:100%;max-width:480px;padding:16px;box-sizing:border-box;display:flex;flex-direction:column;align-items:center;}
header{text-align:center;margin-bottom:16px;}
header h1{font-size:22px;margin-bottom:12px;}
.lantern{width:140px;height:180px;background:linear-gradient(#ffefcf,#ffd79b);border-radius:70px;display:flex;align-items:center;justify-content:center;font-size:52px;font-weight:700;margin:0 auto 12px;transform-origin:50% 0%;transition:transform .35s ease;box-shadow:0 6px 18px rgba(0,0,0,.5), inset 0 -8px 24px rgba(0,0,0,.08);}
.lantern.shake{animation:shake 0.7s;}
@keyframes shake{0%{transform:rotate(0)}20%{transform:rotate(-10deg)}40%{transform:rotate(8deg)}60%{transform:rotate(-6deg)}80%{transform:rotate(4deg)}100%{transform:rotate(0)}}
.btn{padding:16px 0;border-radius:12px;background:#ffb74d;color:#2b1700;font-weight:700;border:none;margin:8px 0;width:90%;font-size:18px;box-shadow:0 6px 18px rgba(255,183,77,.2);}
.btn:active{transform:translateY(2px);}
.result{width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));border-radius:14px;padding:16px;margin-top:16px;display:flex;flex-direction:column;align-items:center;min-height:220px;}
.card{width:90%;background:#fff;color:#222;border-radius:12px;padding:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-bottom:12px;display:none;}
.card .kanji{font-size:56px;font-weight:900;}
.card .label{font-size:20px;color:#666;margin-top:6px;}
.message{color:#e7eefc;font-size:16px;line-height:1.6;text-align:center;margin-bottom:8px;}
.meta{font-size:12px;color:#b9c9df;}
footer{font-size:12px;color:#9fb0d0;text-align:center;margin-top:8px;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜</h1>
    <div class="lantern" id="lantern">?</div>
  </header>
  <button id="drawBtn" class="btn">ãŠã¿ãã˜ã‚’ã²ã</button>
  <div class="result">
    <div class="card" id="cardPreview">
      <div class="kanji" id="cardKanji"></div>
      <div class="label" id="cardFortune"></div>
    </div>
    <div class="message" id="cardMessage">
      ã‚¿ãƒƒãƒ—ã—ã¦ä»Šæ—¥ã®é‹å‹¢ã‚’ç¢ºèªã—ã‚ˆã†ï¼
      <div class="meta">â€” å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜</div>
    </div>
  </div>
  <button id="downloadBtn" class="btn" style="display:none;background:#9dd0ff;color:#063a54">ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  <footer>â€»ã“ã®ç”»é¢ã‚’ä¿å­˜ã—ã¦æ—…ã®æ€ã„å‡ºã«</footer>
</div>

<script>
(() => {
const pool=[
{kanji:"åŸ",fortune:"å¤§å‰",emoji:"ğŸ¯",message:"å°ç”°åŸåŸã®å¤©å®ˆã®ã”ã¨ãé«˜ã¿ã¸ç™»ã‚‹é‹æ°—ã€‚æ—…ã®å§‹ã¾ã‚Šã«å¤§ããªãƒãƒ£ãƒ³ã‚¹ï¼"},
{kanji:"åŸ",fortune:"ä¸­å‰",emoji:"ğŸ›¡ï¸",message:"åŸä¸‹ã®ç¸ã«æµã¾ã‚Œã‚‹ã¨ãã€‚æ–°ã—ã„å‡ºä¼šã„ãŒå¹¸é‹ã‚’é‹ã¶ã€‚"},
{kanji:"åŸ",fortune:"å°å‰",emoji:"ğŸª¨",message:"çŸ³å£ã®å¦‚ãã˜ã£ãã‚Šã¨é‹ãŒå›ºã¾ã‚‹ã€‚ç„¦ã‚‰ãšæ­©ã‚‚ã†ã€‚"},
{kanji:"æµ·",fortune:"å¤§å‰",emoji:"ğŸŒŠ",message:"ç›¸æ¨¡æ¹¾ã®å¤§æ¼ã®ã”ã¨ãå¹¸é‹ãŒã‚ãµã‚Œã‚‹æ—…ã«ï¼"},
{kanji:"æµ·",fortune:"ä¸­å‰",emoji:"ğŸŸ",message:"ã‚¢ã‚¸ã®æ—¨å‘³ã®ã‚ˆã†ã«å°‘ã—ãšã¤æ¥½ã—ã¿ãŒæ·±ã¾ã‚‹æ™‚ã€‚"},
{kanji:"æ¢…",fortune:"å¤§å‰",emoji:"ğŸŒ¸",message:"æ¢…ã®èŠ±ã®ã”ã¨ãå¬‰ã—ã„ã“ã¨ãŒé–‹èŠ±ã™ã‚‹äºˆæ„Ÿã€‚è¨˜å¿µã«ãµã•ã‚ã—ã„æ—¥ï¼"},
{kanji:"é­š",fortune:"å‰",emoji:"ğŸ ",message:"æ¸¯ç”ºã®æµã¿ã‚ã‚Šã€‚é£Ÿã‚„æ–°ç™ºè¦‹ãŒæ—…ã‚’å½©ã‚‹ã§ã—ã‚‡ã†ã€‚"},
{kanji:"ç¥­",fortune:"å¤§å‰",emoji:"ğŸ",message:"æç¯ã¨ç¥­ã®è³‘ã‚ã„ã®ã‚ˆã†ã«ã€æ¥½ã—ã„å‡ºä¼šã„ãŒå¾…ã£ã¦ã„ã¾ã™ï¼"},
{kanji:"å…‰",fortune:"å‰",emoji:"âœ¨",message:"åœ°ä¸‹ã§ã‚‚å…‰ã¯è¦‹ãˆã‚‹ã€‚æ–°ã—ã„é“ãŒé–‹ã‘ã‚‹äºˆæ„Ÿï¼"},
{kanji:"é“",fortune:"ä¸­å‰",emoji:"ğŸ›£ï¸",message:"æ±æµ·é“ã®å¿ƒã§é€²ã‚ã€‚é“ä¸­ã®å‡ºä¼šã„ãŒå¹¸é‹ã‚’å‘¼ã¶ã€‚"},
];

const lantern=document.getElementById('lantern');
const drawBtn=document.getElementById('drawBtn');
const downloadBtn=document.getElementById('downloadBtn');
const cardKanji=document.getElementById('cardKanji');
const cardFortune=document.getElementById('cardFortune');
const cardMessage=document.getElementById('cardMessage');
const cardPreview=document.getElementById('cardPreview');

function rand(a){return Math.floor(Math.random()*a);}
function animateLantern(){lantern.classList.remove('shake');void lantern.offsetWidth;lantern.classList.add('shake');}
function showResult(item){
  cardKanji.textContent=item.kanji;
  cardFortune.textContent=item.fortune;
  cardMessage.innerHTML=`<div style="font-size:28px;margin-bottom:6px">${item.emoji} <strong style="font-size:16px">${item.kanji} â€” ${item.fortune}</strong></div><div style="font-size:14px;line-height:1.5">${item.message}</div><div class="meta">â€” å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜ï¼ˆè¨˜å¿µã‚«ãƒ¼ãƒ‰ï¼‰</div>`;
  lantern.textContent=item.kanji;
  cardPreview.style.display='flex';
  downloadBtn.style.display='block';
}

// ä»Šæ—¥1å›åˆ¶é™ãƒã‚§ãƒƒã‚¯
function canDrawToday(){
  const lastDate = localStorage.getItem('odawara-omikuji-date');
  const today = new Date().toISOString().slice(0,10);
  return lastDate !== today;
}

drawBtn.addEventListener('click',()=>{
  if(!canDrawToday()){
    cardMessage.innerHTML='ä»Šæ—¥ã®é‹å‹¢ã¯ã‚‚ã†å¼•ãã¾ã—ãŸï¼<br>æ˜æ—¥ã¾ãŸãŠæ¥½ã—ã¿ã«ã€‚<div class="meta">â€” å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜</div>';
    return;
  }
  animateLantern();
  drawBtn.disabled=true;
  drawBtn.textContent='çµæœã‚’è¡¨ç¤ºä¸­â€¦';
  setTimeout(()=>{
    const result = pool[rand(pool.length)];
    showResult(result);
    const today = new Date().toISOString().slice(0,10);
    localStorage.setItem('odawara-omikuji-date', today);
    drawBtn.disabled=false;
    drawBtn.textContent='ãŠã¿ãã˜ã‚’ã²ã';
  },600);
});

// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
downloadBtn.addEventListener('click',()=>{
  window.scrollTo(0,0);
  html2canvas(document.querySelector(".wrap")).then(canvas=>{
    const link=document.createElement('a');
    link.download='odawara_omikuji.png';
    link.href=canvas.toDataURL("image/png");
    link.click();
  });
});

// html2canvasèª­ã¿è¾¼ã¿
const script=document.createElement('script');
script.src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
document.body.appendChild(script);

})();
</script>
</body>
</html>
