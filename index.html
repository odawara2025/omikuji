<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å°ç”°åŸ åœ°ä¸‹è¡—ãŠã¿ãã˜</title>
<style>
  html,body{height:100%;margin:0;font-family: "Hiragino Kaku Gothic Pro","Yu Gothic","Noto Sans JP",sans-serif;background:linear-gradient(#0b1220,#101827);color:#fff;display:flex;align-items:center;justify-content:center;}
  .wrap{width:920px;max-width:95%;background:linear-gradient(180deg,#08101a 0%, #0d1720 100%);border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.6);}
  header{display:flex;align-items:center;gap:16px;margin-bottom:12px;}
  header h1{font-size:20px;margin:0;}
  .lantern-area{display:flex;gap:18px;align-items:center;}
  .lantern{
    width:140px;height:200px;background:linear-gradient(#ffefcf,#ffd79b);border-radius:70px;display:flex;align-items:center;justify-content:center;
    color:#8b3e00;font-weight:700;font-size:48px;box-shadow:0 6px 18px rgba(0,0,0,.5), inset 0 -8px 24px rgba(0,0,0,.08);
    transform-origin:50% 0%;transition:transform .35s ease;
  }
  .lantern.shake{animation:shake 0.7s;}
  @keyframes shake{0%{transform:rotate(0)}20%{transform:rotate(-10deg)}40%{transform:rotate(8deg)}60%{transform:rotate(-6deg)}80%{transform:rotate(4deg)}100%{transform:rotate(0)}}
  .controls{flex:1;}
  .btn{
    display:inline-block;padding:12px 18px;border-radius:10px;background:#ffb74d;color:#2b1700;font-weight:700;border:none;cursor:pointer;margin-right:8px;
    box-shadow:0 6px 18px rgba(255,183,77,.12);
  }
  .btn:active{transform:translateY(2px)}
  .hint{font-size:13px;color:#c6d3df;margin-top:8px}
  .result{
    margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));border-radius:12px;padding:18px;display:flex;gap:14px;align-items:center;
    min-height:120px;
  }
  .card{
    background:linear-gradient(180deg,#fff 0%, #f7f7f7 100%);color:#222;border-radius:10px;padding:12px;width:320px;height:180px;flex-shrink:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
    box-shadow:0 6px 18px rgba(2,6,23,.35);
  }
  .card .kanji{font-size:64px;font-weight:900;}
  .card .label{font-size:14px;color:#666;margin-top:6px}
  .message{flex:1;color:#e7eefc;font-size:16px;line-height:1.5}
  .meta{font-size:13px;color:#b9c9df;margin-top:10px}
  footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center}
  .small{font-size:12px;color:#9fb0d0}
  @media(max-width:640px){
    .lantern{width:110px;height:160px;font-size:40px}
    .card{width:240px;height:150px}
  }
</style>
</head>
<body>
  <div class="wrap" role="application">
    <header>
      <div class="lantern-area">
        <div id="lantern" class="lantern">åŸ</div>
      </div>
      <div class="controls">
        <h1>å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜</h1>
        <div class="hint">æç¯ã‚’ã²ã£ã±ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€ŒãŠã¿ãã˜ã‚’ã²ãã€ã‚’æŠ¼ã—ã¦ã­ã€‚è¦³å…‰ã®è¨˜å¿µã«ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</div>
        <div style="margin-top:10px;">
          <button id="drawBtn" class="btn">ãŠã¿ãã˜ã‚’ã²ã</button>
          <button id="downloadBtn" class="btn" style="display:none;background:#9dd0ff;color:#063a54">ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>
      </div>
    </header>

    <section class="result" aria-live="polite">
      <div class="card" id="cardPreview">
        <div class="kanji" id="cardKanji">åŸ</div>
        <div class="label" id="cardFortune">å¤§å‰</div>
      </div>
      <div class="message" id="cardMessage">
        ã“ã“ã«å°ç”°åŸã‚‰ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>ä¾‹ï¼šå°ç”°åŸåŸã®å¤©å®ˆã®ã‚ˆã†ã«é«˜ã¿ã¸ç™»ã‚‹é‹æ°—ã€‚æ—…ã®è¨˜å¿µã«ï¼
        <div class="meta" id="cardMeta">â€” å°ç”°åŸ åœ°ä¸‹è¡—ã‚ªãƒŸã‚¯ã‚¸</div>
      </div>
    </section>

    <footer>
      <div class="small">â€»ã“ã®ç”»é¢ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ—…ã®æ€ã„å‡ºã«ã€‚</div>
      <div class="small">ãƒ‡ã‚¶ã‚¤ãƒ³ã®æ–‡è¨€ã¯è‡ªç”±ã«ç·¨é›†ã§ãã¾ã™</div>
    </footer>
  </div>

<script>
(() => {
  // ãŠã¿ãã˜ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆè¦³å…‰è¨˜å¿µå‘ã‘ï¼‰
  const pool = [
    // format: {kanji, fortune, emoji, message}
    {kanji:"åŸ", fortune:"å¤§å‰", emoji:"ğŸ¯", message:"å°ç”°åŸåŸã®å¤©å®ˆã®ã”ã¨ãé«˜ã¿ã¸ç™»ã‚‹é‹æ°—ã€‚æ—…ã®å§‹ã¾ã‚Šã«å¤§ããªãƒãƒ£ãƒ³ã‚¹ï¼"},
    {kanji:"åŸ", fortune:"ä¸­å‰", emoji:"ğŸ›¡ï¸", message:"åŸä¸‹ã®ç¸ã«æµã¾ã‚Œã‚‹ã¨ãã€‚æ–°ã—ã„å‡ºä¼šã„ãŒå¹¸é‹ã‚’é‹ã¶ã€‚"},
    {kanji:"åŸ", fortune:"å°å‰", emoji:"ğŸª¨", message:"çŸ³å£ã®å¦‚ãã˜ã£ãã‚Šã¨é‹ãŒå›ºã¾ã‚‹ã€‚ç„¦ã‚‰ãšæ­©ã‚‚ã†ã€‚"},
    {kanji:"æµ·", fortune:"å¤§å‰", emoji:"ğŸŒŠ", message:"ç›¸æ¨¡æ¹¾ã®å¤§æ¼ã®ã”ã¨ãå¹¸é‹ãŒã‚ãµã‚Œã‚‹æ—…ã«ï¼"},
    {kanji:"æµ·", fortune:"ä¸­å‰", emoji:"ğŸŸ", message:"ã‚¢ã‚¸ã®æ—¨å‘³ã®ã‚ˆã†ã«å°‘ã—ãšã¤æ¥½ã—ã¿ãŒæ·±ã¾ã‚‹æ™‚ã€‚"},
    {kanji:"æµ·", fortune:"å°å‰", emoji:"â›µ", message:"å°èˆŸã®ã‚ˆã†ã«æ…é‡ã«é€²ã‚ã°å‰ã€‚å®‰å…¨ç¬¬ä¸€ã§å‹•ã“ã†ã€‚"},
    {kanji:"æ¢…", fortune:"å¤§å‰", emoji:"ğŸŒ¸", message:"æ¢…ã®èŠ±ã®ã”ã¨ãå¬‰ã—ã„ã“ã¨ãŒé–‹èŠ±ã™ã‚‹äºˆæ„Ÿã€‚è¨˜å¿µã«ãµã•ã‚ã—ã„æ—¥ï¼"},
    {kanji:"æ¢…", fortune:"ä¸­å‰", emoji:"ğŸ¯", message:"æ¢…å¹²ã—ã®é…¸å‘³ãŒåŠ›ã«ã€‚è©¦ç·´ãŒå‘³ã‚ã„ã«ãªã‚‹ã¨ãã€‚"},
    {kanji:"é­š", fortune:"å‰", emoji:"ğŸ ", message:"æ¸¯ç”ºã®æµã¿ã‚ã‚Šã€‚é£Ÿã‚„æ–°ç™ºè¦‹ãŒæ—…ã‚’å½©ã‚‹ã§ã—ã‚‡ã†ã€‚"},
    {kanji:"ç¥­", fortune:"å¤§å‰", emoji:"ğŸ", message:"æç¯ã¨ç¥­ã®è³‘ã‚ã„ã®ã‚ˆã†ã«ã€æ¥½ã—ã„å‡ºä¼šã„ãŒå¾…ã£ã¦ã„ã¾ã™ï¼"},
    {kanji:"ç¥­", fortune:"å°å‰", emoji:"ğŸ", message:"ãŠç¥­ã‚Šã®æº–å‚™ã¯ç€å®Ÿã«ã€‚å°ã•ãªç¬‘é¡”ãŒå¤§ããªæ€ã„å‡ºã«ã€‚"},
    {kanji:"å…‰", fortune:"å‰", emoji:"âœ¨", message:"åœ°ä¸‹ã§ã‚‚å…‰ã¯è¦‹ãˆã‚‹ã€‚æ–°ã—ã„é“ãŒé–‹ã‘ã‚‹äºˆæ„Ÿï¼"},
    {kanji:"é“", fortune:"ä¸­å‰", emoji:"ğŸ›£ï¸", message:"æ±æµ·é“ã®å¿ƒã§é€²ã‚ã€‚é“ä¸­ã®å‡ºä¼šã„ãŒå¹¸é‹ã‚’å‘¼ã¶ã€‚"},
    {kanji:"é£Ÿ", fortune:"å‰", emoji:"ğŸ¡", message:"ã”å½“åœ°ã‚°ãƒ«ãƒ¡ãŒé‹ã‚’å‘¼ã¶æ—¥ã€‚ç¾å‘³ã—ã„ç™ºè¦‹ã‚’æ¥½ã—ã‚“ã§ã€‚"},
    {kanji:"æµª", fortune:"å‡¶", emoji:"ğŸŒŠ", message:"æ³¢ãŒè’ã„æ—¥ã€‚æ—…ã®äºˆå®šã¯æ…é‡ã«ã€‚åˆ‡ã‚Šæ›¿ãˆãŒå‰ã€‚"},
    {kanji:"åŸ", fortune:"å‡¶", emoji:"âš”ï¸", message:"ä¸€æ™‚ã®ã¤ã¾ãšãã‚ã‚Šã€‚å°ã•ãªæº–å‚™ã§å†ã³ç«‹ã¦ç›´ã›ã‚‹ã€‚"}
  ];

  // DOM
  const lantern = document.getElementById('lantern');
  const drawBtn = document.getElementById('drawBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const cardKanji = document.getElementById('cardKanji');
  const cardFortune = document.getElementById('cardFortune');
  const cardMessage = document.getElementById('cardMessage');
  const cardMeta = document.getElementById('cardMeta');
  const cardPreview = document.getElementById('cardPreview');

  // helper random
  function rand(a){ return Math.floor(Math.random()*a); }

  function showResult(item) {
    cardKanji.textContent = item.kanji;
    cardFortune.textContent = item.fortune;
    // message area: emoji + message + meta
    cardMessage.innerHTML = `<div style="font-size:28px;margin-bottom:8px">${item.emoji} <strong style="font-size:18px">${item.kanji} â€” ${item.fortune}</strong></div><div style="font-size:15px;line-height:1.6">${item.message}</div><div class="meta" style="margin-top:10px;color:#b9c9df">â€” å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜ï¼ˆè¨˜å¿µã‚«ãƒ¼ãƒ‰ï¼‰</div>`;
    downloadBtn.style.display = 'inline-block';
    // update lantern kanji too
    lantern.textContent = item.kanji;
  }

  function animateLantern() {
    lantern.classList.remove('shake');
    // force reflow to restart animation
    void lantern.offsetWidth;
    lantern.classList.add('shake');
  }

  drawBtn.addEventListener('click', ()=> {
    animateLantern();
    drawBtn.disabled = true;
    drawBtn.textContent = 'çµæœã‚’è¡¨ç¤ºä¸­â€¦';
    // simulate draw delay
    setTimeout(()=> {
      const item = pool[rand(pool.length)];
      showResult(item);
      drawBtn.disabled = false;
      drawBtn.textContent = 'ãŠã¿ãã˜ã‚’ã²ã';
    }, 800);
  });

  // Create PNG from the card + message area using canvas
  function downloadCardImage() {
    // create canvas
    const w = 920, h = 480;
    const canvas = document.createElement('canvas');
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext('2d');

    // background
    const grad = ctx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'#08101a'); grad.addColorStop(1,'#0d1720');
    ctx.fillStyle = grad; ctx.fillRect(0,0,w,h);

    // left card box
    ctx.fillStyle = '#fff';
    const cardX = 36, cardY = 48, cardW = 420, cardH = 384, r=12;
    // rounded rect
    roundRect(ctx, cardX, cardY, cardW, cardH, r, true, false);
    // kanji big
    ctx.fillStyle = '#222';
    ctx.font = 'bold 140px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(cardKanji.textContent, cardX + cardW/2, cardY + 170);

    // fortune label
    ctx.font = '700 30px sans-serif';
    ctx.fillText(cardFortune.textContent, cardX + cardW/2, cardY + 230);

    // right message box (white text)
    ctx.fillStyle = 'rgba(255,255,255,0.04)';
    roundRect(ctx, 480, 48, 404, 384, r, true, false);

    // message content (we will draw the inner HTML's text)
    ctx.fillStyle = '#e7eefc';
    ctx.font = '600 22px sans-serif';
    ctx.textAlign = 'left';
    // extract plain text (emoji + message)
    const plain = extractPlainText(cardMessage);
    // wrap text
    wrapText(ctx, plain, 500, 120, 380, 28);

    // footer meta
    ctx.font = '14px sans-serif';
    ctx.fillStyle = '#9fb0d0';
    ctx.fillText('â€” å°ç”°åŸ åœ°ä¸‹è¡— ãŠã¿ãã˜ï¼ˆè¨˜å¿µã‚«ãƒ¼ãƒ‰ï¼‰', 500, 420);

    // create download
    const link = document.createElement('a');
    link.download = 'odawara_omikuji.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  }

  function extractPlainText(el) {
    // remove tags, keep emoji + text
    return el.innerText || el.textContent || '';
  }

  function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
    const words = text.split(/\s+/);
    let line = '';
    let curY = y;
    for (let n = 0; n < words.length; n++) {
      const testLine = line + words[n] + ' ';
      const metrics = ctx.measureText(testLine);
      const testWidth = metrics.width;
      if (testWidth > maxWidth && n > 0) {
        ctx.fillText(line, x, curY);
        line = words[n] + ' ';
        curY += lineHeight;
      } else {
        line = testLine;
      }
    }
    ctx.fillText(line, x, curY);
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke) {
    if (typeof stroke === 'undefined') stroke = true;
    if (typeof r === 'undefined') r = 5;
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y,   x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x,   y+h, r);
    ctx.arcTo(x,   y+h, x,   y,   r);
    ctx.arcTo(x,   y,   x+w, y,   r);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) ctx.stroke();
  }

  downloadBtn.addEventListener('click', downloadCardImage);

  // initialize with a gentle sample
  showResult(pool[0]);

})();
</script>
</body>
</html>
